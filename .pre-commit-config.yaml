default_language_version:
  python: python3.11

repos:
- repo: https://github.com/pre-commit/pre-commit-hooks
  rev: v6.0.0
  hooks:
  - id: trailing-whitespace
    args: [--markdown-linebreak-ext=md]
  - id: end-of-file-fixer
  - id: check-yaml
    args: [--unsafe]
  - id: check-json
  - id: check-toml
  - id: check-added-large-files
    args: ["--maxkb=1000"]
  - id: check-merge-conflict
  - id: check-case-conflict
  - id: mixed-line-ending
    args: [--fix=lf]
  - id: detect-private-key
  - id: no-commit-to-branch
    name: block commits to main
    args: [--branch, main]

- repo: https://github.com/astral-sh/ruff-pre-commit
  rev: v0.15.2
  hooks:
  - id: ruff
    name: ruff check
    args: [--fix]
  - id: ruff-format
    name: ruff format

- repo: https://github.com/macisamuele/language-formatters-pre-commit-hooks
  rev: v2.16.0
  hooks:
  - id: pretty-format-yaml
    args: [--autofix, --indent=2, --preserve-quotes]
    exclude: ^\.github/

- repo: https://github.com/executablebooks/mdformat
  rev: 1.0.0
  hooks:
  - id: mdformat
    additional_dependencies:
    - mdformat-gfm
    args: [--wrap=100]
    exclude: ^CHANGELOG.md$

- repo: https://github.com/Yelp/detect-secrets
  rev: v1.5.0
  hooks:
  - id: detect-secrets
    exclude: ^(\.env\.template|tests/fixtures/)

- repo: local
  hooks:
  - id: forbid-mock
    name: forbid mock usage
    entry: bash -c 'if grep -nE "\\bmock\\b|mock_|_mock|--mock" "$@"; then echo "Mock usage is forbidden. Use CPU backend for validation."; exit 1; fi'
    language: system
    types: [text]
    pass_filenames: true
    exclude: ^(\.pre-commit-config\.yaml|pyproject\.toml|\.mypy_cache/|\.ruff_cache/|\.pytest_cache/|docs/|\.github/workflows/|CHANGELOG\.md)
